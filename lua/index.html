<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.useso.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Lua," />





  <link rel="alternate" href="/rss2.xml" title="Wenyu's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="注释  单行注释 两个减号，-- 多行注释 --[[ 内容 --]]">
<meta name="keywords" content="Lua">
<meta property="og:type" content="article">
<meta property="og:title" content="Lua基础语法">
<meta property="og:url" content="https://tianwenyu.github.io/lua/index.html">
<meta property="og:site_name" content="Wenyu&#39;s Blog">
<meta property="og:description" content="注释  单行注释 两个减号，-- 多行注释 --[[ 内容 --]]">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-12-24T14:03:28.951Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lua基础语法">
<meta name="twitter:description" content="注释  单行注释 两个减号，-- 多行注释 --[[ 内容 --]]">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: undefined,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://tianwenyu.github.io/lua/"/>

  <title> Lua基础语法 | Wenyu's Blog </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  








  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div style="display: none;">
    <script src="//s6.cnzz.com/stat.php?id=1271854965&web_id=1271854965" type="text/javascript"></script>
  </div>





  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>
    
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader" style="background-image: url('/images/home_bg.jpg');">
      <div class="header-inner"><a class="site-home" href="/">Wenyu's Blog</a>

<div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <div href="/"  class="brand">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Wenyu's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </div>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            博文归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签云
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <input type="text" id="local-search-input">
 <span class="search-icon fa fa-search"></span>
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
      <div class="header-post"> 
  <div class="post-header">
      <div class="tags">
      
        <a href="/tags/Lua/" rel="tag" title="Lua">Lua</a>
      
      </div>
      <h1>Lua基础语法</h1>
      <h2 class="subtitle"></h2>
      <div class="post-time">
        <span class="post-meta-item-text">发表于 </span>
        <time itemprop="dateCreated" datetime="2017-05-20T20:23:58+08:00" content="2017-05-20" title="2017-05-20 20:23:58">
          2017-05-20
        </time>
      </div>
  </div>
 </div>
    </header>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Lua基础语法
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-05-20T20:23:58+08:00" content="2017-05-20">
              2017-05-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Lua/" itemprop="url" rel="index">
                    <span itemprop="name">Lua</span>
                  </a>
                </span>

                
                

              
            </span>
          

          <!-- 
            
           -->

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="注释">注释</h2>
<ul>
<li>单行注释 两个减号，<code>--</code></li>
<li>多行注释 <code>--[[ 内容 --]]</code> <a id="more"></a> ## 数据类型</li>
<li>Lua是动态类型语言，变量不需要类型定义，只需为变量赋值</li>
</ul>
<table style="width:11%;">
<colgroup>
<col width="5%">
<col width="5%">
</colgroup>
<thead>
<tr class="header">
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>nil</td>
<td>只有值&quot;nil&quot;属于该类，表示一个无效值(在条件表达式里相当于false)</td>
</tr>
<tr class="even">
<td>boolean</td>
<td>false 和 true</td>
</tr>
<tr class="odd">
<td>number</td>
<td>双精度类型的实浮点数</td>
</tr>
<tr class="even">
<td>string</td>
<td>由一对双引号<code>&quot; &quot;</code>或单引号<code>' '</code>表示</td>
</tr>
<tr class="odd">
<td>function</td>
<td>由C或Lua编写的函数</td>
</tr>
<tr class="even">
<td>userdata</td>
<td>表示任意存储在变量中的C数据结构</td>
</tr>
<tr class="odd">
<td>thread</td>
<td>表示执行的独立线路</td>
</tr>
<tr class="even">
<td>table</td>
<td>Lua 中的表（table）其实是一个&quot;关联数组&quot;（associative arrays），数组的索引可以是数字或者是字符串。在 Lua 里，table 的创建是通过&quot;构造表达式&quot;来完成，最简单构造表达式是{}，用来创建一个空表。</td>
</tr>
</tbody>
</table>
<h3 id="nil">nil</h3>
<ul>
<li>nil类型表示一种没有任何有效值,它只有一个值&quot;nil&quot;</li>
<li>对于全局变量和table,nil的另外一个作用为删除，给全局变量或table表里的变量赋值nil,等于把它们删掉 ### boolean</li>
<li>Lua把false和nil看作“假”，其余为“真” ### number</li>
<li>Lua默认只有一种number类型，即double(双精度)类型，默认类型可以修改luaconf.h里的定义。以下几种写法都是number类型 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">&gt;<span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">2</span>))</span><br><span class="line">&gt;<span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">2.2</span>))</span><br><span class="line">&gt;<span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">0.2</span>))</span><br><span class="line">&gt;<span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">2e+1</span>))</span><br><span class="line">&gt;<span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">0.2e-1</span>))</span><br><span class="line">&gt;<span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">7.8263692594256e-06</span>))</span><br><span class="line"></span><br><span class="line">number</span><br><span class="line">number</span><br><span class="line">number</span><br><span class="line">number</span><br><span class="line">number</span><br><span class="line">number</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="string">string</h3>
<ul>
<li>由一对双引号<code>&quot; &quot;</code>或单引号<code>' '</code>表示</li>
<li><p>两个方括号<code>[[   ]]</code>表示一块字符串 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">&gt;html = <span class="string">[[</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;a href="http://www.w3cschool.cc/"&gt;w3cschool菜鸟教程&lt;/a&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">]]</span></span><br><span class="line"><span class="built_in">print</span>(html)</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;a href=<span class="string">"http://www.w3cschool.cc/"</span>&gt;w3cschool菜鸟教程&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p></li>
<li><p>在对一个数字字符串上进行算术操作时，Lua会将数字字符串转成一个数字 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">&gt; <span class="built_in">print</span>(<span class="string">"2"</span> + <span class="number">6</span>)</span><br><span class="line"><span class="number">8.0</span></span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="string">"2"</span> + <span class="string">"6"</span>)</span><br><span class="line"><span class="number">8.0</span></span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="string">"2 + 6"</span>)</span><br><span class="line"><span class="number">2</span> + <span class="number">6</span></span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="string">"-2e2"</span> * <span class="string">"6"</span>)</span><br><span class="line"><span class="number">-1200.0</span></span><br><span class="line">&gt; <span class="built_in">print</span>(<span class="string">"error"</span> + <span class="number">1</span>)</span><br><span class="line"><span class="built_in">stdin</span>:<span class="number">1</span>: attempt to perform arithmetic on a <span class="built_in">string</span> value</span><br><span class="line">stack <span class="built_in">traceback</span>:</span><br><span class="line">	<span class="built_in">stdin</span>:<span class="number">1</span>: <span class="keyword">in</span> main chunk</span><br><span class="line">	[C]: <span class="keyword">in</span> ?</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p></li>
<li><p>字符串连接需要用<code>..</code>,需加上空格 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">&gt;<span class="built_in">print</span>(<span class="string">'a'</span> .. <span class="string">'b'</span>)</span><br><span class="line">ab</span><br><span class="line"></span><br><span class="line">&gt;<span class="built_in">print</span>(<span class="number">157</span> .. <span class="number">333</span>)</span><br><span class="line"><span class="number">157333</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>使用<code>#</code>计算字符串的长度，放在字符串前面 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">&gt;<span class="built_in">len</span>=<span class="string">'www.w3cshool.cc'</span></span><br><span class="line">&gt;<span class="built_in">print</span>(#<span class="built_in">len</span>)</span><br><span class="line"><span class="number">16</span></span><br><span class="line">&gt;<span class="built_in">print</span>(#<span class="string">'www.w3cschool.cc'</span>)</span><br><span class="line"><span class="number">16</span></span><br></pre></td></tr></table></figure></p></li>
</ul>
<h3 id="table">table</h3>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">--创建一个空表</span></span><br><span class="line"><span class="keyword">local</span> table1=&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">--初始表</span></span><br><span class="line"><span class="keyword">local</span> table2=&#123;<span class="string">'apple'</span>,<span class="string">'pear'</span>,<span class="string">'orange'</span>,<span class="string">'grape'</span>&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Lua中的table是一个&quot;关联数组&quot;,数组的索引可以数字或字符串 <strong>【注】</strong>Lua中table 默认初始索引从1开始 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">a=&#123;&#125;</span><br><span class="line">a[<span class="string">'key'</span>]=<span class="string">'value'</span></span><br><span class="line">key=<span class="number">10</span></span><br><span class="line">a[key]=<span class="number">22</span></span><br><span class="line">a[key]=a[key]+<span class="number">11</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(a) <span class="keyword">do</span></span><br><span class="line">	<span class="built_in">print</span>(k .. <span class="string">':'</span> .. v)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">结果</span><br><span class="line">key:value</span><br><span class="line"><span class="number">10</span>:<span class="number">33</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="function">function</h3>
<ul>
<li>在Lua中，function被看作是&quot;第一类值(First-Class Value)&quot;,函数可以存在变量里</li>
</ul>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial1</span><span class="params">(n)</span></span></span><br><span class="line">	<span class="keyword">if</span> n==<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="keyword">return</span> n*factorial1(n<span class="number">-1</span>)</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(factorial1(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">factorial2=factorial1</span><br><span class="line"><span class="built_in">print</span>(fatorial2(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">结果</span><br><span class="line"><span class="number">120</span></span><br><span class="line"><span class="number">120</span></span><br></pre></td></tr></table></figure>
<h3 id="userdata">userdata</h3>
<p>userdata 是一种用户自定义数据，用于表示一种由应用程序或 C/C++ 语言库所创建的类型，可以将任意 C/C++ 的任意数据类型的数据（通常是 struct 和 指针）存储到 Lua 变量中调用。</p>
<h2 id="变量">变量</h2>
<ul>
<li>变量在使用前，必须在代码中进行声明，即创建该变量。</li>
<li>Lua 变量有三种类型：全局变量、局部变量、表中的域</li>
<li>变量的默认值均为 nil。</li>
</ul>
<h3 id="标识符">标识符</h3>
<ul>
<li>一般用下划线加大写字母的标识符，为Lua的保留字。如：_VERSION 为保留用于Lua内部全局变量</li>
<li>区分大小写 ### 全局变量</li>
<li>默认是全局变量</li>
<li><p>全局变量无需声明，给一个变量赋值后即创建了这个全局变量，访问一个没有初始化的全局变量也不会出错，得到的结果为：nil <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line">&gt;<span class="literal">nil</span></span><br><span class="line">b=<span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line">&gt;<span class="number">10</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>删除一个全局变量，将变量赋值为nil即可 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">b=<span class="literal">nil</span></span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line">&gt;<span class="literal">nil</span></span><br></pre></td></tr></table></figure></p></li>
</ul>
<h3 id="局部变量">局部变量</h3>
<p>使用<code>local</code>声明 应该尽可能的使用局部变量，有两个好处： 1. 避免命名冲突。 2. 访问局部变量的速度比全局变量更快。 ### 赋值语句 * Lua可以对多个变量同时赋值，变量列表和值列表的各个元素用逗号分开，赋值语句右边的值会依次赋给左边的变量。 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">a, b = <span class="number">10</span>, <span class="number">2</span>*x       &lt;<span class="comment">--&gt;       a=10; b=2*x</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>遇到赋值语句Lua会先计算右边所有的值然后再执行赋值操作，所以我们可以这样进行交换变量的值： <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">x, y = y, x                     <span class="comment">-- swap 'x' for 'y'</span></span><br><span class="line">a[i], a[j] = a[j], a[i]         <span class="comment">-- swap 'a[i]' for 'a[j]'</span></span><br></pre></td></tr></table></figure></p></li>
<li>当变量个数和值的个数不一致时，Lua会一直以变量个数为基础采取以下策略：</li>
</ul>
<ol style="list-style-type: decimal">
<li>变量个数 &gt; 值的个数 按变量个数补足nil</li>
<li>变量个数 &lt; 值的个数 多余的值会被忽略</li>
</ol>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">&gt;a, b, c = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">&gt;<span class="built_in">print</span>(a,b,c)             </span><br><span class="line"></span><br><span class="line"><span class="number">0</span>   <span class="number">1</span>   <span class="literal">nil</span></span><br><span class="line"> </span><br><span class="line">&gt;a, b = a+<span class="number">1</span>, b+<span class="number">1</span>, b+<span class="number">2</span>     <span class="comment">-- value of b+2 is ignored</span></span><br><span class="line">&gt;<span class="built_in">print</span>(a,b)               </span><br><span class="line">&gt;<span class="number">1</span>   <span class="number">2</span></span><br><span class="line"> </span><br><span class="line">&gt;a, b, c = <span class="number">0</span></span><br><span class="line">&gt;<span class="built_in">print</span>(a,b,c)             </span><br><span class="line"></span><br><span class="line"><span class="number">0</span>   <span class="literal">nil</span>   <span class="literal">nil</span></span><br></pre></td></tr></table></figure>
<ul>
<li>多值赋值经常用来交换变量，或将函数调用返回给变量： <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">a,b=fun()</span><br></pre></td></tr></table></figure></li>
</ul>
<p>f()返回两个值，第一个赋给a，第二个赋给b。 ## 循环 ### while <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>(condition)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	statements</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<h3 id="for">for</h3>
<p>Lua中for语句有两大类: * 数值for循环 * 泛型for循环</p>
<h4 id="数值for循环">数值for循环</h4>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> var=exp1,exp2,exp3 <span class="keyword">do</span></span><br><span class="line">	statements</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<ul>
<li>var从exp1变化到exp2，每次变化以exp3为步长递增var，并执行一次&quot;执行体&quot;。exp3是可选的，如果不指定，默认为1</li>
<li>for的三个表达式在循环开始前一次性求值，以后不再进行求值。 #### 泛型for循环 用过一个迭代器遍历所有值 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">--打印数组a 的所有值</span></span><br><span class="line"><span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(a)</span><br><span class="line">	<span class="keyword">do</span> <span class="built_in">print</span>(v)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>i是数组索引值，v是对应索引的数组元素值。ipairs是Lua提供的一个迭代器函数，用来迭代数组。</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">days=&#123;<span class="string">"Suanday"</span>,<span class="string">"Monday"</span>,<span class="string">"Tuesday"</span>,<span class="string">"Wednesday"</span>,<span class="string">"Thursday"</span>,<span class="string">"Friday"</span>,<span class="string">"Saturday"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(days) <span class="keyword">do</span></span><br><span class="line">	<span class="built_in">print</span>(v)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">结果</span><br><span class="line">Suanday</span><br><span class="line">Monday</span><br><span class="line">Tuesday</span><br><span class="line">Wednesday</span><br><span class="line">Thursday</span><br><span class="line">Friday</span><br><span class="line">Saturday</span><br></pre></td></tr></table></figure>
<h4 id="repeat...until">repeat...until</h4>
<p>Lua 编程语言中 repeat...until 循环语句不同于 for 和 while循环，for 和 while 循环的条件语句在当前循环执行开始时判断，而 repeat...until 循环的条件语句在当前循环结束后判断。</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">repeat</span></span><br><span class="line">	statements</span><br><span class="line"><span class="keyword">until</span>(contidion)</span><br></pre></td></tr></table></figure>
<p>我们注意到循环条件判断语句（condition）在循环体末尾部分，所以在条件进行判断前循环体都会执行一次。 ## 函数</p>
<h3 id="函数作为参数">函数作为参数</h3>
<p>Lua 中我们可以将函数作为参数传递给函数 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">myprint = <span class="function"><span class="keyword">function</span><span class="params">(param)</span></span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">"这是打印函数 -   ##"</span>,param,<span class="string">"##"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(num1,num2,functionPrint)</span></span></span><br><span class="line">   result = num1 + num2</span><br><span class="line">   <span class="comment">-- 调用传递的函数参数</span></span><br><span class="line">   functionPrint(result)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">myprint(<span class="number">10</span>)</span><br><span class="line"><span class="comment">-- myprint 函数作为参数传递</span></span><br><span class="line">add(<span class="number">2</span>,<span class="number">5</span>,myprint)</span><br><span class="line"></span><br><span class="line">结果</span><br><span class="line">这是打印函数 -   ##	<span class="number">10</span>	##</span><br><span class="line">这是打印函数 -   ##	<span class="number">7</span>	##</span><br></pre></td></tr></table></figure></p>
<h3 id="多返回值">多返回值</h3>
<ul>
<li><p>Lua可以返回多个结果值，如string.find，返回匹配串“开始和结束的下标”（如果不存在匹配串返回nil） <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">&gt;s,e=<span class="built_in">string</span>.<span class="built_in">find</span>(<span class="string">'www.runoob.com'</span>,<span class="string">'runoob'</span>)</span><br><span class="line">&gt;<span class="built_in">print</span>(s,e)</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>   <span class="number">10</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>Lua函数中，在return后列出要返回的值得列表即可返回多值</p></li>
</ul>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">maximum</span><span class="params">(a)</span></span></span><br><span class="line">	<span class="keyword">local</span> mi=<span class="number">1</span>    <span class="comment">--最大值索引</span></span><br><span class="line">	<span class="keyword">local</span> m=a[mi] <span class="comment">--最大值</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> i,val <span class="keyword">in</span> <span class="built_in">ipairs</span>(a) <span class="keyword">do</span></span><br><span class="line">		<span class="keyword">if</span> val &gt; m <span class="keyword">then</span> </span><br><span class="line">			mi=i</span><br><span class="line">			m=val</span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line">	<span class="keyword">return</span> m,mi</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(maximum(&#123;<span class="number">8</span>,<span class="number">10</span>,<span class="number">23</span>,<span class="number">12</span>,<span class="number">5</span>&#125;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">结果</span><br><span class="line"><span class="number">23</span>    <span class="number">3</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>return f()这种形式，则返回“f()的返回值”： <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo0</span><span class="params">()</span></span> <span class="keyword">end</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo1</span><span class="params">()</span></span> <span class="keyword">return</span> <span class="string">'a'</span> <span class="keyword">end</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo2</span><span class="params">()</span></span> <span class="keyword">return</span> <span class="string">'a'</span>,<span class="string">'b'</span> <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">(i)</span></span></span><br><span class="line">	<span class="keyword">if</span> i==<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">return</span> foo0()</span><br><span class="line">	<span class="keyword">elseif</span> i==<span class="number">1</span> <span class="keyword">then</span> <span class="keyword">return</span> foo1()</span><br><span class="line">	<span class="keyword">elseif</span> i==<span class="number">2</span> <span class="keyword">then</span> <span class="keyword">return</span> foo2()</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">&gt;<span class="built_in">print</span>(foo(<span class="number">1</span>))</span><br><span class="line">a</span><br><span class="line">&gt;<span class="built_in">print</span>(foo(<span class="number">2</span>))</span><br><span class="line">a b</span><br><span class="line">&gt;<span class="built_in">print</span>(foo(<span class="number">0</span>))</span><br><span class="line">     <span class="comment">--(no result)</span></span><br><span class="line">&gt;<span class="built_in">print</span>(foo(<span class="number">3</span>))</span><br><span class="line">	 <span class="comment">--(no result)</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>可以使用圆括号<code>( )</code>强制使调用返回一个值 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">&gt;<span class="built_in">print</span>((foo0()))</span><br><span class="line"><span class="literal">nil</span></span><br><span class="line">&gt;<span class="built_in">print</span>((foo1()))</span><br><span class="line">a</span><br><span class="line">&gt;<span class="built_in">print</span>((foo2()))</span><br><span class="line">a</span><br></pre></td></tr></table></figure></p></li>
<li><p>函数多值返回的特殊函数unpack，接受一个数组作为输入参数，返回数组的所有元素。unpack被用来实现范型调用机制，在C语言中可以使用函数指针调用可变的函数，可以声明参数可变的函数，但不能两者同时可变。在Lua中如果你想调用可变参数的可变函数只需要这样： <code>f(unpack(a))</code> unpack返回a所有的元素作为f()的参数 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">f=<span class="built_in">string</span>.<span class="built_in">find</span></span><br><span class="line">a=&#123;<span class="string">'hello'</span>,<span class="string">'ll'</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(f(<span class="built_in">unpack</span>(a)))</span><br><span class="line"></span><br><span class="line"><span class="comment">--&gt;3 4</span></span><br></pre></td></tr></table></figure></p></li>
</ul>
<p>预定义的unpack函数是用C语言实现的，也可以用Lua实现 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unpack</span><span class="params">(t,i)</span></span></span><br><span class="line">	i= i <span class="keyword">or</span> <span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span> t[i] <span class="keyword">then</span></span><br><span class="line">		<span class="keyword">return</span> t[i],<span class="built_in">unpack</span>(t,i+<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<h3 id="可变参数">可变参数</h3>
<ul>
<li>Lua函数可以接受可变数目的参数，和C语言类似在函数参数列表中使用三点（...) 表示函数有可变的参数。</li>
<li>Lua将函数的参数放在一个叫arg的表中，#arg 表示传入参数的个数。 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">average</span><span class="params">(...)</span></span></span><br><span class="line">	result = <span class="number">0</span></span><br><span class="line">	<span class="keyword">local</span> <span class="built_in">arg</span>=&#123;...&#125;</span><br><span class="line">	<span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(<span class="built_in">arg</span>) <span class="keyword">do</span> </span><br><span class="line">		result = result + v</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">'总共传入'</span> .. #<span class="built_in">arg</span> .. <span class="string">'个数'</span>)</span><br><span class="line">	<span class="keyword">return</span> result/#<span class="built_in">arg</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'平均值为'</span>,average(<span class="number">10</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>))</span><br><span class="line"></span><br><span class="line">结果</span><br><span class="line">总共传入 <span class="number">6</span> 个数</span><br><span class="line">平均值为	<span class="number">5.5</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="再论函数">再论函数</h3>
<p>Lua中的函数是带有词法定界(lexical scoping)的第一类值(first-class value) #### 第一类值 在Lua中函数和其他值（数值、字符串）一样，函数可以被存放在变量中，也可以存放在table中，可以作为函数的参数，还可以作为函数的返回值 #### 词法定界 嵌套的函数可以访问它外部函数中的变量</p>
<ul>
<li>Lua中关于函数难以理解的地方时函数也可以是匿名的。 函数名（如print）实际上是一个指向函数的变量，像具有其他类型值的变量一样 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">a=&#123;p=<span class="built_in">print</span>&#125;</span><br><span class="line">a.p(<span class="string">'hello world'</span>)   <span class="comment">--&gt;hello world</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>=<span class="built_in">math</span>.<span class="built_in">sin</span>      <span class="comment">-- print now refers to the sin function</span></span><br><span class="line"></span><br><span class="line">a.p(<span class="built_in">print</span>(<span class="number">1</span>))  		<span class="comment">--&gt;0.841470</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sin</span>=a.p				<span class="comment">--sin now refers to the print function</span></span><br><span class="line"><span class="built_in">sin</span>(<span class="number">10</span>,<span class="number">20</span>)			<span class="comment">--&gt;10 20</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="闭包">闭包</h3>
<p>当一个函数内部嵌套另一个函数定义时，内部的函数体可以访问外部的函数的局部变量，这种特征我们称作词法定界。虽然这看起来很清楚，事实并非如此，词法定界加上第一类函数在编程语言里是一个功能强大的概念，很少语言提供这种支持。 下面看一个简单的例子，假定有一个学生姓名的列表和一个学生名和成绩对应的表；现在想根据学生的成绩从高到低对学生进行排序，可以这样做： <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">names=&#123;<span class="string">'Peter'</span>,<span class="string">'Paul'</span>,<span class="string">'Mary'</span>&#125;</span><br><span class="line">grades=&#123;Mary=<span class="number">10</span>,Paul=<span class="number">7</span>,Peter=<span class="number">8</span>&#125;</span><br><span class="line"><span class="built_in">table</span>.<span class="built_in">sort</span>(names,<span class="function"><span class="keyword">function</span> <span class="params">(n1,n2)</span></span></span><br><span class="line">	<span class="keyword">return</span> grades[n1]&gt;grades[n2]</span><br><span class="line"><span class="keyword">end</span>)</span><br></pre></td></tr></table></figure></p>
<p>假定创建一个函数实现此功能 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sortByGrade</span><span class="params">(names,grades)</span></span></span><br><span class="line">	<span class="built_in">table</span>.<span class="built_in">sort</span>(names,<span class="function"><span class="keyword">function</span><span class="params">(n1,n2)</span></span></span><br><span class="line">		<span class="keyword">return</span> grades[n1]&gt;grades[n2]</span><br><span class="line">	<span class="keyword">end</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>例子中包含在sortbygrade函数内部的sort中的匿名函数可以访问sortbygrade的参数grades，在匿名函数内部grades不是全局变量也不是局部变量，我们称作外部的局部变量（external local variable）或者upvalue。（upvalue意思有些误导，然而在Lua中他的存在有历史的根源，还有他比起external local variable简短）。</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newCounter</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span></span>     <span class="comment">-- anonymous function</span></span><br><span class="line">       i = i + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line">c1 = newCounter()</span><br><span class="line"><span class="built_in">print</span>(c1())  <span class="comment">--&gt; 1</span></span><br><span class="line"><span class="built_in">print</span>(c1())  <span class="comment">--&gt; 2</span></span><br></pre></td></tr></table></figure>
<p>匿名函数使用upvalue i保存他的计数，当我们调用匿名函数的时候i已经超出了作用范围，因为创建i的函数newCounter已经返回了。然而Lua用闭包的思想正确处理了这种情况。简单的说，闭包是一个函数以及它的upvalues。如果我们再次调用newCounter，将创建一个新的局部变量i，因此我们得到了一个作用在新的变量i上的新闭包。 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">c2 = newCounter()</span><br><span class="line"><span class="built_in">print</span>(c2())  <span class="comment">--&gt; 1</span></span><br><span class="line"><span class="built_in">print</span>(c1())  <span class="comment">--&gt; 3</span></span><br><span class="line"><span class="built_in">print</span>(c2())  <span class="comment">--&gt; 2</span></span><br></pre></td></tr></table></figure></p>
<p>c1、c2是建立在同一个函数上，但作用在同一个局部变量的不同实例上的两个不同的闭包。 技术上来讲，闭包指值而不是指函数，函数仅仅是闭包的一个原型声明；尽管如此，在不会导致混淆的情况下我们继续使用术语函数代指闭包。 闭包在上下文环境中提供很有用的功能，如前面我们见到的可以作为高级函数（sort）的参数；作为函数嵌套的函数（newCounter）。这一机制使得我们可以在Lua的函数世界里组合出奇幻的编程技术。闭包也可用在回调函数中，比如在GUI环境中你需要创建一系列button，但用户按下button时回调函数被调用，可能不同的按钮被按下时需要处理的任务有点区别。具体来讲，一个十进制计算器需要10个相似的按钮，每个按钮对应一个数字，可以使用下面的函数创建他们： <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">digitButton</span> <span class="params">(digit)</span></span></span><br><span class="line">    <span class="keyword">return</span> Button&#123;  label = digit,</span><br><span class="line">           action = <span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br><span class="line">              add_to_display(digit)</span><br><span class="line">           <span class="keyword">end</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>这个例子中我们假定Button是一个用来创建新按钮的工具， label是按钮的标签，action是按钮被按下时调用的回调函数。（实际上是一个闭包，因为他访问upvalue digit）。digitButton完成任务返回后，局部变量digit超出范围，回调函数仍然可以被调用并且可以访问局部变量digit。 闭包在完全不同的上下文中也是很有用途的。因为函数被存储在普通的变量内我们可以很方便的重定义或者预定义函数。通常当你需要原始函数有一个新的实现时可以重定义函数。例如你可以重定义sin使其接受一个度数而不是弧度作为参数： <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">oldSin = <span class="built_in">math</span>.<span class="built_in">sin</span></span><br><span class="line"><span class="built_in">math</span>.<span class="built_in">sin</span> = <span class="function"><span class="keyword">function</span> <span class="params">(x)</span></span></span><br><span class="line">    <span class="keyword">return</span> oldSin(x*<span class="built_in">math</span>.<span class="built_in">pi</span>/<span class="number">180</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>更清楚的方式 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">local</span> oldSin = <span class="built_in">math</span>.<span class="built_in">sin</span></span><br><span class="line">    <span class="keyword">local</span> k = <span class="built_in">math</span>.<span class="built_in">pi</span>/<span class="number">180</span></span><br><span class="line">    <span class="built_in">math</span>.<span class="built_in">sin</span> = <span class="function"><span class="keyword">function</span> <span class="params">(x)</span></span></span><br><span class="line">       <span class="keyword">return</span> oldSin(x*k)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>这样我们把原始版本放在一个局部变量内，访问sin的唯一方式是通过新版本的函数。 利用同样的特征我们可以创建一个安全的环境（也称作沙箱，和java里的沙箱一样），当我们运行一段不信任的代码（比如我们运行网络服务器上获取的代码）时安全的环境是需要的，比如我们可以使用闭包重定义io库的open函数来限制程序打开的文件。 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">local</span> oldOpen = <span class="built_in">io</span>.<span class="built_in">open</span></span><br><span class="line">    <span class="built_in">io</span>.<span class="built_in">open</span> = <span class="function"><span class="keyword">function</span> <span class="params">(filename, mode)</span></span></span><br><span class="line">       <span class="keyword">if</span> access_OK(filename, mode) <span class="keyword">then</span></span><br><span class="line">           <span class="keyword">return</span> oldOpen(filename, mode)</span><br><span class="line">       <span class="keyword">else</span></span><br><span class="line">           <span class="keyword">return</span> <span class="literal">nil</span>, <span class="string">"access denied"</span></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<h3 id="非全局函数">非全局函数</h3>
<p>Lua中函数可以作为全局变量也可以作为局部变量，我们已经看到一些例子：</p>
<ul>
<li>函数作为table的域（大部分Lua标准库使用这种机制来实现的比如io.read、math.sin）。这种情况下，必须注意函数和表语法：</li>
</ul>
<ol style="list-style-type: decimal">
<li><p>表和函数放在一起 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">Lib=&#123;&#125;</span><br><span class="line">Lib.foo=<span class="function"><span class="keyword">function</span> <span class="params">(x,y)</span></span> <span class="keyword">return</span> x+y <span class="keyword">end</span></span><br><span class="line">Lib.foo=<span class="function"><span class="keyword">function</span> <span class="params">(x,y)</span></span> <span class="keyword">return</span> x-y <span class="keyword">end</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>使用表构造函数 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">Lib=&#123;</span><br><span class="line">	foo = <span class="function"><span class="keyword">function</span> <span class="params">(x,y)</span></span> <span class="keyword">return</span> x+y <span class="keyword">end</span>,</span><br><span class="line">	goo = <span class="function"><span class="keyword">function</span> <span class="params">(x,y)</span></span> <span class="keyword">return</span> x-y <span class="keyword">end</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li>
<li><p>Lua提供另一种语法方式 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">Lib=&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Lib.foo</span> <span class="params">(x,y)</span></span></span><br><span class="line">	<span class="keyword">return</span> x+y</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Lib.goo</span> <span class="params">(x,y)</span></span></span><br><span class="line">	<span class="keyword">return</span> x-y</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p></li>
</ol>
<p>当我们将函数保存在一个局部变量内时，我们得到一个局部函数，也就是说局部函数像局部变量一样在一定范围内有效。这种定义在包中是非常有用的：因为Lua把chunk当作函数处理，在chunk内可以声明局部函数（仅仅在chunk内可见），词法定界保证了包内的其他函数可以调用此函数。下面是声明局部函数的两种方式： 1.方式一 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> f=<span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">	...</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> g=<span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">	...</span><br><span class="line">	f()           <span class="comment">-- external loca 'f' is visible here</span></span><br><span class="line">	...</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>2.方式二 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> funciton f()</span><br><span class="line">	...</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>有一点需要注意的是在声明递归局部函数的方式： <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> fact=<span class="function"><span class="keyword">function</span> <span class="params">(n)</span></span></span><br><span class="line">	<span class="keyword">if</span> n==<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="keyword">return</span> n*fact(n<span class="number">-1</span>)  <span class="comment">-- buggy</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>上面这种方式导致Lua编译时遇到fact(n-1)并不知道他是局部函数fact，Lua会去查找是否有这样的全局函数fact。为了解决这个问题我们必须在定义函数以前先声明： <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> fact</span><br><span class="line"></span><br><span class="line">fact=<span class="function"><span class="keyword">function</span> <span class="params">(n)</span></span></span><br><span class="line">	<span class="keyword">if</span> n==<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="keyword">return</span> n*fact(n<span class="number">-1</span>)</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>这样在fact内部fact(n-1)调用是一个局部函数调用，运行时fact就可以获取正确的值了。 但是Lua扩展了他的语法使得可以在直接递归函数定义时使用两种方式都可以。 在定义非直接递归局部函数时要先声明然后定义才可以： <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> f,g			<span class="comment">--forward declarations</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">g</span><span class="params">()</span></span></span><br><span class="line">		...</span><br><span class="line">		f()</span><br><span class="line">		...</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span><span class="params">()</span></span></span><br><span class="line">		...</span><br><span class="line">		g()</span><br><span class="line">		...</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<h2 id="运算符">运算符</h2>
<h3 id="关系运算符">关系运算符</h3>
<ul>
<li><code>~=</code> 不等于 ### 逻辑运算符 Lua中false 和 nil 是假，其余为真，0也是true</li>
<li><code>and</code> 逻辑与</li>
<li><code>or</code> 逻辑或</li>
<li><code>not</code> 逻辑非</li>
</ul>
<p><code>and</code>优先级比<code>or</code>高</p>
<p>and 和 or 的运算结果不是<code>true</code>和<code>false</code>，而是和它的两个操作数有关。 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">a <span class="keyword">and</span> b   <span class="comment">--如果a为false，返回a，否则返回b</span></span><br><span class="line"></span><br><span class="line">a <span class="keyword">or</span> b    <span class="comment">--如果a为true，则返回a，否则返回b</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">&gt;<span class="built_in">print</span>(<span class="number">4</span> <span class="keyword">and</span> <span class="number">5</span>)</span><br><span class="line"><span class="number">5</span></span><br><span class="line">&gt;<span class="built_in">print</span>(<span class="literal">nil</span> <span class="keyword">and</span> <span class="number">13</span>)</span><br><span class="line"><span class="literal">nil</span></span><br><span class="line">&gt;<span class="built_in">print</span>(<span class="literal">false</span> <span class="keyword">and</span> <span class="number">13</span>)</span><br><span class="line"><span class="literal">false</span></span><br><span class="line">&gt;<span class="built_in">print</span>(<span class="number">4</span> <span class="keyword">or</span> <span class="number">5</span>)</span><br><span class="line"><span class="number">4</span></span><br><span class="line">&gt;<span class="built_in">print</span>(<span class="literal">false</span> <span class="keyword">or</span> <span class="number">5</span>)</span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>一个实用的技巧：如果x为<code>false</code>或<code>nil</code>，则给x赋值初始值v <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">x = x <span class="keyword">or</span> v</span><br><span class="line">&lt;==&gt;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> x <span class="keyword">then</span> </span><br><span class="line">	x=v</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>C语言中的三元运算符 <code>a?b:c</code> 在Lua中可以如此实现 <code>(a and b) or c</code></p></li>
<li><code>not</code>的结果只返回<code>false</code>或<code>true</code> ### 其他运算符</li>
<li><code>..</code> 连接两个字符串</li>
<li><p><code>#</code> 返回字符串或table 的长度</p></li>
</ul>
<h2 id="字符串">字符串</h2>
<h3 id="常用操作">常用操作</h3>
<table style="width:11%;">
<colgroup>
<col width="5%">
<col width="5%">
</colgroup>
<thead>
<tr class="header">
<th>函数</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>string.upper(arg)</td>
<td>转为大写字母</td>
</tr>
<tr class="even">
<td>string.lower(arg)</td>
<td>转为小写字母</td>
</tr>
<tr class="odd">
<td>string.gsub(mainString,findString,replaceString,num)</td>
<td>在字符串中替换，mainString为要替换的字符串,findString为被替换的字符,replaceString为要替换的字符,num为替换次数(可忽略，则全部替换)</td>
</tr>
<tr class="even">
<td>string.find(str,subStr,[init,end])</td>
<td>在一个指定的目标字符串中搜索指定的内容，第三个参数为索引，返回具体位置,不存在返回nil</td>
</tr>
<tr class="odd">
<td>string.reverse(arg)</td>
<td>字符串反转</td>
</tr>
<tr class="even">
<td>string.format(...)</td>
<td>返回一个类似print的格式化字符串</td>
</tr>
<tr class="odd">
<td>string.char(arg)和string.byte(arg,[int])</td>
<td>char将整形数字转成字符并连接,byte将字符转为整数值（可以指定某个字符，默认第一个字符）</td>
</tr>
<tr class="even">
<td>string.len(arg)</td>
<td>计算长度</td>
</tr>
<tr class="odd">
<td>string.rep(string,n)</td>
<td>返回字符串的n个拷贝</td>
</tr>
</tbody>
</table>
<h2 id="table-1">table</h2>
<ul>
<li><p>table 使用关联型数组，你可以用任意类型的值来作数组的索引，但这个值不能是 nil。</p></li>
<li>table 是不固定大小的，你可以根据自己需要进行扩容。</li>
<li><p>Lua也是通过table来解决模块（module）、包（package）和对象（Object）的。 例如string.format表示使用&quot;format&quot;来索引table string。 ### table的构造 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">--初始表</span></span><br><span class="line">myTable=&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">--指定值</span></span><br><span class="line">myTable[<span class="number">1</span>]=<span class="string">'Lua'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--移除引用</span></span><br><span class="line">myTable=<span class="literal">nil</span>      <span class="comment">--Lua垃圾回收会释放内存</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>当我们为 table a 并设置元素，然后将 a 赋值给 b，则 a 与 b 都指向同一个内存。如果 a 设置为 nil ，则 b 同样能访问 table 的元素。如果没有指定的变量指向a，Lua的垃圾回收机制会清理相对应的内存。 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 简单的 table</span></span><br><span class="line">mytable = &#123;&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"mytable 的类型是 "</span>,<span class="built_in">type</span>(mytable))</span><br><span class="line"></span><br><span class="line">mytable[<span class="number">1</span>]= <span class="string">"Lua"</span></span><br><span class="line">mytable[<span class="string">"wow"</span>] = <span class="string">"修改前"</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"mytable 索引为 1 的元素是 "</span>, mytable[<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"mytable 索引为 wow 的元素是 "</span>, mytable[<span class="string">"wow"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">-- alternatetable和mytable的是指同一个 table</span></span><br><span class="line">alternatetable = mytable</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"alternatetable 索引为 1 的元素是 "</span>, alternatetable[<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"mytable 索引为 wow 的元素是 "</span>, alternatetable[<span class="string">"wow"</span>])</span><br><span class="line"></span><br><span class="line">alternatetable[<span class="string">"wow"</span>] = <span class="string">"修改后"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"mytable 索引为 wow 的元素是 "</span>, mytable[<span class="string">"wow"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 释放变量</span></span><br><span class="line">alternatetable = <span class="literal">nil</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"alternatetable 是 "</span>, alternatetable)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- mytable 仍然可以访问</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"mytable 索引为 wow 的元素是 "</span>, mytable[<span class="string">"wow"</span>])</span><br><span class="line"></span><br><span class="line">mytable = <span class="literal">nil</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"mytable 是 "</span>, mytable)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">结果</span><br><span class="line">mytable 的类型是 	<span class="built_in">table</span></span><br><span class="line">mytable 索引为 <span class="number">1</span> 的元素是 	Lua</span><br><span class="line">mytable 索引为 wow 的元素是 	修改前</span><br><span class="line">alternatetable 索引为 <span class="number">1</span> 的元素是 	Lua</span><br><span class="line">mytable 索引为 wow 的元素是 	修改前</span><br><span class="line">mytable 索引为 wow 的元素是 	修改后</span><br><span class="line">alternatetable 是 	<span class="literal">nil</span></span><br><span class="line">mytable 索引为 wow 的元素是 	修改后</span><br><span class="line">mytable 是 	<span class="literal">nil</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>构造函数可以使用任何表达式初始化 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">tab=&#123;<span class="built_in">sin</span>(<span class="number">1</span>),<span class="built_in">sin</span>(<span class="number">2</span>),<span class="built_in">sin</span>(<span class="number">3</span>),<span class="built_in">sin</span>(<span class="number">4</span>),<span class="built_in">sin</span>(<span class="number">5</span>)&#125;</span><br></pre></td></tr></table></figure></p></li>
<li><p>在构造函数中域分隔符逗号（&quot;,&quot;）可以用分号（&quot;;&quot;）替代，通常我们使用分号用来分割不同类型的表元素。</p></li>
</ul>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">tab=&#123;x=<span class="number">10</span>, y=<span class="number">45</span>; <span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="常用操作-1">常用操作</h3>
<table style="width:11%;">
<colgroup>
<col width="5%">
<col width="5%">
</colgroup>
<thead>
<tr class="header">
<th>函数</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>table.concat(table,sep,start,end)</td>
<td>concat是concatenate(连接)的缩写.table.concat()列出指定table从strat位置到end位置的所有元素，元素间以指定分隔符（sep）隔开</td>
</tr>
<tr class="even">
<td>table.insert(table,pos,value)</td>
<td>在table的指定位置pos插入值为value的元素</td>
</tr>
<tr class="odd">
<td>table.remove(table,pos)</td>
<td>返回table位于pos未知的元素，其余元素前移</td>
</tr>
<tr class="even">
<td>table.sort(table,comp)</td>
<td>对table升序排序</td>
</tr>
</tbody>
</table>
<h2 id="模块与包">模块与包</h2>
<h3 id="创建模块">创建模块</h3>
<ul>
<li>模块类似于一个封装库，从 Lua 5.1 开始，Lua 加入了标准的模块管理机制，可以把一些公用的代码放在一个文件里，以 API 接口的形式在其他地方调用，有利于代码的重用和降低代码耦合度。</li>
<li>Lua 的模块是由变量、函数等已知元素组成的 table，因此创建一个模块很简单，就是创建一个 table，然后把需要导出的常量、函数放入其中，最后返回这个 table 就行。 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">--定义一个名为module的模块</span></span><br><span class="line">module=&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">--定义一个常量</span></span><br><span class="line">module.constant=<span class="string">'这是一个常量'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--定义一个函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">module.func1</span><span class="params">()</span></span></span><br><span class="line">	<span class="built_in">io</span>.<span class="built_in">write</span>(<span class="string">'这是一个公有函数'</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> funtion func2()</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">'这是一个私有函数'</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">module.func3</span><span class="params">()</span></span></span><br><span class="line">	func2()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> module</span><br></pre></td></tr></table></figure></li>
</ul>
<p>由上可知，模块的结构就是一个 table 的结构，因此可以像操作调用 table 里的元素那样来操作调用模块里的常量或函数。 上面的 func2 声明为程序块的局部变量，即表示一个私有函数，因此是不能从外部访问模块里的这个私有函数，必须通过模块里的公有函数来调用. ### require函数 * require函数用来加载模块 <code>require('模块名')</code> * 也可以给加载的模块定义一个别名变量,如 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> m=<span class="built_in">require</span>(<span class="string">'module'</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="c包">C包</h3>
<ul>
<li>Lua和C是很容易结合的，使用C为Lua写包。</li>
<li>与Lua中写包不同，C包在使用以前必须首先加载并连接，在大多数系统中最容易的实现方式是通过动态连接库机制。</li>
<li><p>Lua在一个叫loadlib的函数内提供了所有的动态连接的功能。这个函数有两个参数:库的绝对路径和初始化函数。所以典型的调用的例子如下: <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="built_in">path</span> = <span class="string">"/usr/local/lua/lib/libluasocket.so"</span></span><br><span class="line"><span class="keyword">local</span> f = <span class="built_in">loadlib</span>(<span class="built_in">path</span>, <span class="string">"luaopen_socket"</span>)</span><br></pre></td></tr></table></figure></p></li>
<li>loadlib函数加载指定的库并且连接到Lua，然而它并不打开库（也就是说没有调用初始化函数），反之他返回初始化函数作为Lua的一个函数，这样我们就可以直接在Lua中调用他。</li>
<li><p>如果加载动态库或者查找初始化函数时出错，loadlib将返回nil和错误信息。我们可以修改前面一段代码，使其检测错误然后调用初始化函数： <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="built_in">path</span> = <span class="string">"/usr/local/lua/lib/libluasocket.so"</span></span><br><span class="line"><span class="comment">-- 或者 path = "C:\\windows\\luasocket.dll"，这是 Window 平台下</span></span><br><span class="line"><span class="keyword">local</span> f = <span class="built_in">assert</span>(<span class="built_in">loadlib</span>(<span class="built_in">path</span>, <span class="string">"luaopen_socket"</span>))</span><br><span class="line">f()  <span class="comment">-- 真正打开库</span></span><br></pre></td></tr></table></figure></p></li>
</ul>
<p>一般情况下我们期望二进制的发布库包含一个与前面代码段相似的stub文件，安装二进制库的时候可以随便放在某个目录，只需要修改stub文件对应二进制库的实际路径即可。 将stub文件所在的目录加入到LUA_PATH，这样设定后就可以使用require函数加载C库了。 ## 迭代器 在Lua中我们常常使用函数来描述迭代器，每次调用该函数就返回集合的下一个元素。Lua 的迭代器包含以下两种类型： * 无状态的迭代器 * 多状态的迭代器 ### 无状态迭代器 无状态的迭代器是指不保留任何状态的迭代器，因此在循环中我们可以利用无状态迭代器避免创建闭包花费额外的代价。 每一次迭代，迭代函数都是用两个变量（状态常量和控制变量）的值作为参数被调用，一个无状态的迭代器只利用这两个值可以获取下一个元素。 这种无状态迭代器的典型的简单的例子是ipairs，他遍历数组的每一个元素。 以下实例我们使用了一个简单的函数来实现迭代器，实现 数字 n 的平方： <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">square</span><span class="params">(iteratorMaxCount,currentNumber)</span></span></span><br><span class="line">	<span class="keyword">if</span> currentNumber&lt;iteratorMaxCount <span class="keyword">then</span></span><br><span class="line">		currentNumber=currentNumber+<span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span> currentNumber,currentNumber*currentNumber</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i,n <span class="keyword">in</span> square,<span class="number">3</span>,<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">	<span class="built_in">print</span>(i,n)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">结果</span><br><span class="line"><span class="number">1</span>	<span class="number">1</span></span><br><span class="line"><span class="number">2</span>	<span class="number">4</span></span><br><span class="line"><span class="number">3</span>	<span class="number">9</span></span><br></pre></td></tr></table></figure></p>
<p>迭代的状态包括被遍历的表（循环过程中不会改变的状态常量）和当前的索引下标（控制变量），ipairs和迭代函数都很简单，我们在Lua中可以这样实现： <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iter</span> <span class="params">(a, i)</span></span></span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    <span class="keyword">local</span> v = a[i]</span><br><span class="line">    <span class="keyword">if</span> v <span class="keyword">then</span></span><br><span class="line">       <span class="keyword">return</span> i, v</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ipairs</span> <span class="params">(a)</span></span></span><br><span class="line">    <span class="keyword">return</span> iter, a, <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>当Lua调用ipairs(a)开始循环时，他获取三个值：迭代函数iter、状态常量a、控制变量初始值0；然后Lua调用iter(a,0)返回1,a[1]（除非a[1]=nil）；第二次迭代调用iter(a,1)返回2,a[2]……直到第一个nil元素。</p>
<h3 id="多状态迭代器">多状态迭代器</h3>
<p>很多情况下，迭代器需要保存多个状态信息而不是简单的状态常量和控制变量，最简单的方法是使用闭包，还有一种方法就是将所有的状态信息封装到table内，将table作为迭代器的状态常量，因为这种情况下可以将所有的信息存放在table内，所以迭代函数通常不需要第二个参数。 以下实例我们创建了自己的迭代器： <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">array=&#123;<span class="string">'Lua'</span>,<span class="string">'Tutorial'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">elementIterator</span><span class="params">(collection)</span></span></span><br><span class="line">	<span class="keyword">local</span> index=<span class="number">0</span></span><br><span class="line">	<span class="keyword">local</span> count=#collection</span><br><span class="line">	<span class="comment">--闭包函数</span></span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">		index=index+<span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span> index&lt;=count <span class="keyword">then</span></span><br><span class="line">			<span class="comment">--返回迭代器当前元素</span></span><br><span class="line">			<span class="keyword">return</span> collection[index]</span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> elementIterator(array) <span class="keyword">do</span> </span><br><span class="line">	<span class="built_in">print</span>(element)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">结果</span><br><span class="line">Lua</span><br><span class="line">Tutorial</span><br></pre></td></tr></table></figure></p>
<h3 id="pairs和ipairs异同">pairs和ipairs异同</h3>
<ul>
<li>同：都能遍历集合(table,数组)</li>
<li>异：
<ul>
<li>ipairs仅能遍历值,按照索引升序遍历，索引中断停止遍历。即不能返回nil，只能返回数字0. 如果遇到nil则退出，只能遍历到集合中出现的第一个不是整数的key</li>
<li>pairs能遍历集合的所有元素。 即pairs可以遍历集合中所有的key，并除了迭代器本身以及遍历表本身还可以返回nil</li>
</ul></li>
</ul>
<p>例1 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> tabFiles=&#123;</span><br><span class="line">	[<span class="number">1</span>]=<span class="string">'test2'</span></span><br><span class="line">	[<span class="number">6</span>]=<span class="string">'test3'</span></span><br><span class="line">	[<span class="number">4</span>]=<span class="string">'test1'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(tabFiles) <span class="keyword">do</span></span><br><span class="line">	<span class="built_in">print</span>(k,v)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">结果为1   test2，在key为2时断开</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></table></figure></p>
<p>例2 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> tabFiles=&#123;</span><br><span class="line">	[<span class="number">2</span>]=<span class="string">'test2'</span></span><br><span class="line">	[<span class="number">6</span>]=<span class="string">'test3'</span></span><br><span class="line">	[<span class="number">4</span>]=<span class="string">'test1'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(tabFiles) <span class="keyword">do</span></span><br><span class="line">	<span class="built_in">print</span>(k,v)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">什么都没输出，因为控制变量初始值按升序遍历，当key为1时，value值为nil，便停止遍历，所以无结果输出</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></table></figure></p>
<p>例3 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> tabFiles = &#123;</span><br><span class="line">    [<span class="number">2</span>] = <span class="string">"test2"</span>,</span><br><span class="line">    [<span class="number">6</span>] = <span class="string">"test3"</span>,</span><br><span class="line">    [<span class="number">4</span>] = <span class="string">"test1"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(tabFiles) <span class="keyword">do</span>  </span><br><span class="line">    <span class="built_in">print</span>(k, v)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--输出2 test2, 6 test3, 4 test1</span></span><br></pre></td></tr></table></figure></p>
<p>例4 <figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> tabFiles=&#123;</span><br><span class="line">	<span class="string">'alpha'</span>,</span><br><span class="line">	<span class="string">'beta'</span>,</span><br><span class="line">	[<span class="number">3</span>]=<span class="string">'no'</span>,</span><br><span class="line">	[<span class="string">'two'</span>]=<span class="string">'yes'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(tabFiles) <span class="keyword">do</span> </span><br><span class="line">	<span class="built_in">print</span>(tabFiles[i])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--输出前三个，因为第四个key不是整数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">pairs</span>(tabFiles) <span class="keyword">do</span> </span><br><span class="line">	<span class="built_in">print</span>(tabFiles[i])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--全部输出</span></span><br></pre></td></tr></table></figure></p>
<h2 id="协同程序coroutine">协同程序(coroutine)</h2>
<h3 id="什么是coroutine">什么是coroutine?</h3>
<p>coroutine与线程类似，拥有独立的堆栈，独立的局部变量，独立的指令指针，同时又与其它协同程序共享全局变量和其它大部分东西。 ### coroutine与线程区别 * 一个具有多线程的可以同时运行几个线程，coroutine则需要彼此协作运行 * 在任一指定时刻只有一个协同程序在运行，并且这个正在运行的协同程序只有在明确的被要求挂起的时候才会被挂起。 ### 常用操作 函数|描述| ---|---| coroutine.create()|创建coroutine,返回coroutine| coroutine.resume()|重启coroutine| coroutine.yield()|挂起coroutine| coroutine.statues()|查看coroutine的状态，有三种：dead，suspend，running| coroutine.wrap()|创建corountine，返回一个函数，一旦调用这个函数，进入coroutine，和create功能重复| corountine.running()|返回正在运行的coroutine，一个coroutine是一个线程，当使用running时，返回一个coroutine的线程号|</p>

        
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Lua/" rel="tag">#Lua</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/markdown-tutorial/" rel="next" title="Markdown基础语法">
                <i class="fa fa-chevron-left"></i> Markdown基础语法
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/lua-continue/" rel="prev" title="Lua的一种continue实现">
                Lua的一种continue实现 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="" />
          <p class="site-author-name" itemprop="name"></p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">77</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">39</span>
                <span class="site-state-item-name">标签云</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/rss2.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/tianwenyu" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#注释"><span class="nav-text">注释</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#nil"><span class="nav-text">nil</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#string"><span class="nav-text">string</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#table"><span class="nav-text">table</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#function"><span class="nav-text">function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#userdata"><span class="nav-text">userdata</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#变量"><span class="nav-text">变量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#标识符"><span class="nav-text">标识符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#局部变量"><span class="nav-text">局部变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#for"><span class="nav-text">for</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#数值for循环"><span class="nav-text">数值for循环</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#repeat...until"><span class="nav-text">repeat...until</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数作为参数"><span class="nav-text">函数作为参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多返回值"><span class="nav-text">多返回值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#可变参数"><span class="nav-text">可变参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#再论函数"><span class="nav-text">再论函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#闭包"><span class="nav-text">闭包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#非全局函数"><span class="nav-text">非全局函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#运算符"><span class="nav-text">运算符</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#关系运算符"><span class="nav-text">关系运算符</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#字符串"><span class="nav-text">字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常用操作"><span class="nav-text">常用操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#table-1"><span class="nav-text">table</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常用操作-1"><span class="nav-text">常用操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模块与包"><span class="nav-text">模块与包</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建模块"><span class="nav-text">创建模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c包"><span class="nav-text">C包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多状态迭代器"><span class="nav-text">多状态迭代器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pairs和ipairs异同"><span class="nav-text">pairs和ipairs异同</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#协同程序coroutine"><span class="nav-text">协同程序(coroutine)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是coroutine"><span class="nav-text">什么是coroutine?</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/BearD01001/hexo-theme-nextd">
    NexTD
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




    <link rel='stylesheet' href='https://imsun.github.io/gitment/style/default.css'>
    <style>
        .gitment-editor-avatar {
            border-bottom: none !important;
        }
        .gitment-container a:hover {
            text-decoration: none !important;
        }
        .gitment-markdown a,
        .gitment-footer-project-link {
            color: #555 !important;
        }
        .gitment-footer-project-link:hover,
        .gitment-editor-logout-link:hover,
        .gitment-editor-footer-tip:hover,
        .gitment-header-issue-link:hover,
        .gitment-comment-name:hover,
        .gitment-markdown a:hover {
            color: #222 !important;
        }
    </style>
    <script src='https://imsun.github.io/gitment/dist/gitment.browser.js'></script>
    <script type='text/javascript'>
        (function() {
            var id = window.location.pathname.replace(/(\/$)/g, '');
            var owner = 'tianwenyu';
            var repo = 'tianwenyu.github.io';
            var clientId = '7e6796bf4bd74a25333f';
            var clientSecret = 'd190223868b2175fbce4094e6485195cef7d3e8a';

            var gitment = new Gitment({
                id: id,
                owner: owner,
                repo: repo,
                oauth: {
                    client_id: clientId,
                    client_secret: clientSecret,
                },
            });
            gitment.render('comments');
        })();
    </script>



	





  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').fadeToggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ decodeURIComponent(data_url) +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').fadeOut(function() {
          $(".popoverlay").remove();
          $('body').css('overflow', '');
      });
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  

  
<script type="text/javascript" async src="//push.zhanzhang.baidu.com/push.js">
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->


</body>
</html>
